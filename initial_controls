import time
from gpiozero import Servo
from time import sleep
import serial

servo = Servo(21)


ser = serial.Serial("/dev/ttyAMA0", 115200)

def read_data():
    while True:
        counter = ser.in_waiting # number of bytes of the serial port
        if counter > 8:
            bytes_serial = ser.read(9)
            ser.reset_input_buffer()



            if bytes_serial[0] == 0x59 and bytes_serial[1] == 0x59: 
                distance = bytes_serial[2] + bytes_serial[3]*256 # multiplied by 256, because the binary data is shifted by 8 to the left (equivalent to "<< 8").     
                                                         # Dist_L, could simply be added resulting in 16-bit data of Dist_Total.
                if(distance < 20):
                    servo.min()
                    sleep(0.5)
                    servo.mid()
                    sleep(1)
                    servo.max()
                    sleep(0.5)
                print("Distance:"+ str(distance))
                time.sleep(1)
                ser.reset_input_buffer()
   
if __name__ == "__main__":
    try:
        if ser.isOpen() == False:
            ser.open()
        read_data()
    except KeyboardInterrupt(): 
        if ser != None:
            ser.close()
            print("program interrupted by the user")
 
